<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.games.mapper.AccountInfoMapper">

    <resultMap type="com.ruoyi.games.domain.AccountInfo" id="AccountInfoResult">
        <id property="userID" column="UserID"/>
        <result property="gameID" column="GameID"/>
        <result property="registerMobile" column="RegisterMobile"/>
        <result property="compellation" column="Compellation"/>
        <result property="userType" column="UserType"/>
        <result property="playTimeCount" column="PlayTimeCount"/>
        <result property="playingGame" column="PlayingGame"/>
        <result property="registerDate" column="RegisterDate"/>
        <result property="lastLogonIp" column="LastLogonIp"/>
        <result property="lastLogonDate" column="LastLogonDate"/>
        <result property="nullity" column="Nullity"/>
        <result property="score" column="Score"/>
        <result property="insureScore" column="InsureScore"/>
        <result property="orderAmount" column="OrderAmount"/>
        <result property="money" column="Money"/>
        <result property="totalCommission" column="TotalCommission"/>
        <result column="recordCount" property="total" />
    </resultMap>

    <sql id="selectAccountVo">
        select Ai.UserID,Ai.GameID,Ai.Accounts, Ai.RegisterMobile,Ai.Compellation,Ai.Nullity,Ai.IsAgent,Ai.PlayingGame,ISNULL(gsi.Score, 0) AS Score,
               ISNULL(gsi.InsureScore, 0) AS InsureScore,Ai.UserType,gsi.PlayTimeCount,ai.RegisterDate,gsi.LastLogonIp,gsi.LastLogonDate,
               isnull(( select isnull(sum(OrderAmount), 0) from RYTreasureDB.dbo.ShareDetailInfo where ShareID in(201, 202) and UserID = Ai.UserID ), 0) as OrderAmount,
               isnull(( select isnull(sum(OrderAmount), 0) from RYTreasureDB.dbo.ShareDetailInfo where ShareID = 700 and UserID = Ai.UserID ), 0) as TotalCommission,
               isnull(( select isnull(sum(Money), 0) from RYTreasureDB.dbo.UserDistills where Result = 1 and UserID = Ai.UserID ), 0) as Money
        from RYAccountsDB.dbo.AccountsInfo Ai inner join RYTreasureDB.dbo.GameScoreInfo gsi on Ai.UserID = gsi.UserID where Ai.IsAndroid = 0
    </sql>

    <select id="selectAccountList" parameterType="com.ruoyi.games.domain.AccountInfo" resultMap="AccountInfoResult">
        <include refid="selectAccountVo" />
        <if test="keyWord != null and keyWord != ''">
            and ( Ai.UserID like '%'+#{keyWord}+'%' OR Ai.GameID LIKE '%'+#{keyWord}+'%' OR Ai.Accounts LIKE  '%'+#{keyWord}+'%' )
        </if>
        <!-- 数据范围过滤 -->
        ${params.dataScope}
    </select>

    <select id="selectAccountPage" parameterType="java.util.Map" resultMap="AccountInfoResult" statementType="CALLABLE">
        {call RYTreasureDB.dbo.JSON_GetAccountsList(
            #{strWhere,mode=IN,jdbcType=VARCHAR},
            #{pageSize,mode=IN,jdbcType=INTEGER},
            #{pageIndex,mode=IN,jdbcType=INTEGER},
            #{pageCount,mode=OUT,jdbcType=INTEGER},
            #{recordCount,mode=OUT,jdbcType=INTEGER})}
    </select>

</mapper> 